<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>php.js - Console</title>

        <link rel="stylesheet" href="stylesheets/styles.css">
        <link rel="stylesheet" href="stylesheets/pygment_trac.css">

        <script src="javascripts/scale.fix.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="author" content="Niklas von Hertzen">
        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="wrapper">
            <header>
                <h1 class="header">php.js</h1>
                <p class="header"></p>

                <ul>
                    <li class="download"><a class="buttons" href="console.html">Console</a></li>
                    <li><a class="buttons github" href="https://github.com/niklasvh/php.js">View On GitHub</a></li>
                </ul>

                <p class="header">

                    <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://phpjs.hertzen.com/"  data-count="horizontal" data-via="niklasvh">Tweet</a>
                <g:plusone size="medium" annotation="inline" href="http://phpjs.hertzen.com/" width="250"></g:plusone>
                </p>


            </header>
            <section>
                <h3>Console</h3>
                <p>Requires an ECMAScript 5 compliant browser.</p>
                <p><a href="index.html">Go back</a></p>

                <h3>PHP Code</h3>
                <textarea id="code" style="width:100%;height:200px;">&lt;?php
// insert code here
echo "Hello world!";


?&gt;</textarea>
                <a href="#" id="run">Run code</a>
                <h3>Result</h3>
                <pre><code id="result"></code></pre>

                <h3>Code</h3>
                <pre><code id="result_code"></code></pre>

            </section>
            <footer>
                <div class="profile">
                    <h3>Niklas von Hertzen</h3>
                    <a href="https://twitter.com/niklasvh"><img src="http://experiments.hertzen.com/base/img/twitter.png" alt="Twitter" /></a>
                    <a href="https://plus.google.com/115030581977322198102/posts"><img src="http://experiments.hertzen.com/base/img/google-plus-black.png" alt="Google+" /></a>
                    <a href="https://facebook.com/vonhertzen"><img src="http://experiments.hertzen.com/base/img/facebook.png" alt="Facebook" /></a>
                    <a href="https://github.com/niklasvh"><img src="http://experiments.hertzen.com/base/img/github.png" alt="Github" /></a>
                    <a href="http://fi.linkedin.com/pub/niklas-von-hertzen/16/522/5ab"><img src="http://experiments.hertzen.com/base/img/linkedin.png" alt="LinkedIn" /></a>
                </div>

                <p style="font-size:10px;"><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
            </footer>
        </div>
        <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
        <script>

            // google analytics
            var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-188600-10']);_gaq.push(['_trackPageview']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();
            // twitter
                !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            // google plus
            (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
            })();
        </script>
        <script src="PHP.min.js"></script>
        <script src="adapters/filesystem/xhr.js"></script>
        <div id="scripts"></div>
        <script>

            var content = document.getElementById("code"),
            loc = window.location,
            gist,
            result_code = document.getElementById("result_code"),
            run = function(e){
                if ( e !== undefined ){
                    e.preventDefault();
                }

                var engine = {},
                path = loc.pathname,
                opts = {
                    SERVER: {
                        SCRIPT_FILENAME: path.substring(0, path.length - 1)
                    }
                };



                opts.filesystem = new PHP.Adapters.XHRFileSystem();


                engine = new PHP( content.value.replace(/\n/g,"\r\n") , opts );
                console.log( engine );
                result.innerHTML = engine.vm.OUTPUT_BUFFER.replace(/</g,"&lt;").replace(/>/g,"&gt;");
                result_code.innerHTML = engine.compiler.src.replace(/</g,"&lt;").replace(/>/g,"&gt;");
            },
            result = document.getElementById("result");
            document.getElementById("run").addEventListener("click", run, false);



            function loadgist( json) {
                if (json.data.files !== undefined ) {
                    console.log(Object.keys(json.data.files));
                    content.value = json.data.files[Object.keys(json.data.files)[0]].content;
                    run();
                }
                console.log( json );
            }
            if ((gist = loc.search.match(/gist=(\d+)/)) !== null) {

                var script = document.createElement("script");
                script.src = "https://api.github.com/gists/" + gist[ 1 ] + "?callback=loadgist";
                document.getElementById("scripts").appendChild( script );



            }


        </script>
    </body>
</html>